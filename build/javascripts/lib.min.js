(function(){null==Number.prototype.toSimplestTime&&(Number.prototype.toSimplestTime=function(){var t,i,e,n,s,r;return 0>=this?"":(t=new Date(1e3*this),this>=3600?(i=t.getHours(),e=t.getMinutes(),s=t.getSeconds(),n=10>e?0:"",r=10>s?0:"",i+":"+n+e+":"+r+s):this>=60?(e=t.getMinutes(),s=t.getSeconds(),r=10>s?0:"",e+":"+r+s):""+t.getSeconds())}),null==String.prototype.toSeconds&&(String.prototype.toSeconds=function(){var t,i,e,n,s;return e=this.split(":").reverse(),n=e[0],i=e[1],t=e[2],s=(parseInt(n,10)||0)+60*(parseInt(i,10)||0)+3600*(parseInt(t,10)||0)}),null==Date.prototype.round&&(Date.prototype.round=function(t){var i;return null==t&&(t=15),i=6e4*t,new Date(Math.round(this.getTime()/i)*i)}),null==Date.prototype.ceil&&(Date.prototype.ceil=function(t){var i;return null==t&&(t=15),i=6e4*t,new Date(Math.ceil(this.getTime()/i)*i)}),null==Date.prototype.floor&&(Date.prototype.floor=function(t){var i;return null==t&&(t=15),i=6e4*t,new Date(Math.floor(this.getTime()/i)*i)}),null==Date.prototype.addMinutes&&(Date.prototype.addMinutes=function(t){return null==t&&(t=15),new Date(this.getTime()+6e4*t)}),null==Date.prototype.simpleTime&&(Date.prototype.simpleTime=function(){var t,i,e;return t=this.getHours(),i=this.getMinutes(),10>i&&(i="0"+i),e="at "+t+":"+i}),null==Date.prototype.simpleDate&&(Date.prototype.simpleDate=function(){var t,i,e,n;return t="",this.isToday()?t+="today":this.isTomorrow()?t+="tomorrow":this.isYesterday()?t+="yesterday":(i=this.getUTCDate(),e=["January","February","March","April","May","June","July","August","September","October","November","December"][this.getUTCMonth()],n=this.getFullYear(),t+=i+" "+e+" "+n),t}),null==Date.prototype.isToday&&(Date.prototype.isToday=function(){var t;return t=new Date,this.getDate()===t.getDate()&&this.getMonth()===t.getMonth()&&this.getYear()===t.getYear()}),null==Date.prototype.isTomorrow&&(Date.prototype.isTomorrow=function(){var t;return t=new Date,t.setHours(t.getHours()+24),this.getDate()===t.getDate()&&this.getMonth()===t.getMonth()&&this.getYear()===t.getYear()}),null==Date.prototype.isYesterday&&(Date.prototype.isYesterday=function(){var t;return t=new Date,t.setHours(t.getHours()-24),this.getDate()===t.getDate()&&this.getMonth()===t.getMonth()&&this.getYear()===t.getYear()})}).call(this),function(){jQuery(function(t){return google.maps.LatLng.prototype.canvasOffset=function(t){var i,e,n,s;return n=new google.maps.LatLng(t.getBounds().getNorthEast().lat(),t.getBounds().getSouthWest().lng()),e=t.getProjection().fromLatLngToPoint(n),i=t.getProjection().fromLatLngToPoint(this),s=Math.pow(2,t.getZoom()),new google.maps.Point(Math.floor((i.x-e.x)*s),Math.floor((i.y-e.y)*s))},google.maps.LatLng.prototype.kmTo=function(t){var i,e,n,s,r,o,a;return s=Math,a=s.PI/180,i=this.lat()*a,e=t.lat()*a,n=i-e,o=this.lng()*a-t.lng()*a,r=2*s.asin(s.sqrt(s.pow(s.sin(n/2),2)+s.cos(i)*s.cos(e)*s.pow(s.sin(o/2),2))),6378.137*r},google.maps.Polyline.prototype.inKm=function(){var t,i,e,n,s,r,o,a;for(o=this.getPath(),s=o.getLength(),i=0,a=o.getArray(),e=n=0,r=a.length;r>n;e=++n)t=a[e],e!==s-1&&(i+=t.kmTo(o.getAt(e+1)));return i},google.maps.Polyline.prototype.inMiles=function(){return.621371192*this.inKm()}})}.call(this),function(){var t=function(t,i){return function(){return t.apply(i,arguments)}};jQuery(function(i){var e;return i.sortable=function(t,i){return new e(t,i)},e=function(){function e(e,n){var s;null==n&&(n={}),this.finish=t(this.finish,this),this.putDown=t(this.putDown,this),this.move=t(this.move,this),this.ignore=t(this.ignore,this),this.ieBeginDrag=t(this.ieBeginDrag,this),this.pickup=t(this.pickup,this),this.unhandle=t(this.unhandle,this),this.handle=t(this.handle,this),this.populate=t(this.populate,this),this.refresh=t(this.refresh,this),s={placeholder:'<li class="placeholder" />',selector:"li",handle:!1,connected:null},this._options=i.extend(s,n),this._placeholder=i(this._options.placeholder),this._placeholder.bind("drop.sortable",this.putDown),this._placeholder.bind("dragover.sortable dragenter.sortable",this.ignore),this._container=i(e),this._container.bind("changed",this.refresh),this._container.bind("appended",this.refresh),this._container.bind("refresh",this.refresh),this._container.bind("dragend.sortable",this.finish),this._handling=!1,this.populate()}return e.prototype.refresh=function(t){var i;return null!=(i=this._items)&&i.off("dragstart.sortable dragend.sortable dragover.sortable dragenter.sortable drop.sortable"),this.populate()},e.prototype.populate=function(){return this._items=this._container.children(this._options.selector),this._items.attr("draggable",!0).bind("dragstart.sortable",this.pickup).bind("dragover.sortable dragenter.sortable",this.move).bind("drop.sortable",this.putDown).bind("dragend.sortable",this.finish),this._options.handle?this._items.find(this._options.handle).bind("mousedown",this.handle).bind("mouseup",this.unhandle):void 0},e.prototype.handle=function(t){return this._handling=!0},e.prototype.unhandle=function(t){return this._handling=!1,!0},e.prototype.pickup=function(t){return t.stopImmediatePropagation(),this._options.handle&&!this._handling?!1:(this._handling=!1,this._dragging=i(t.target),t.originalEvent.dataTransfer="move",t.originalEvent.dataTransfer.setData("Text","sorting"),t.originalEvent.dataTransfer.setDragImage(this._dragging.get(0),0,0),this._original_index=this._dragging.index(),this._original_parent=this._dragging.parent(),this._dragging.addClass("dragging"),this._placeholder.height(this._dragging.outerHeight()),this._original_parent.trigger("sorting",this._dragging))},e.prototype.ieBeginDrag=function(t){return this._handling?!0:(t.target&&t.target.dragDrop&&t.target.dragDrop(),!1)},e.prototype.ignore=function(t){return t.preventDefault(),t.originalEvent.dataTransfer="move",!0},e.prototype.move=function(t){var e,n,s,r;return null!=this._dragging&&this._items.is(this._dragging)?(t.preventDefault(),t.stopPropagation(),e=i(t.currentTarget),this._dragging.hide(),r=null!=this._placeholder.parent().get(0),s=null!=r?this._placeholder.index():this._original_index,n=e.index(),s>n?e.before(this._placeholder):e.after(this._placeholder)):!0},e.prototype.putDown=function(t){return t.stopPropagation(),t.originalEvent.dataTransfer.dropEffect="move",this._dragging.insertAfter(this._placeholder),this._dragging.trigger("dragend.sortable"),!1},e.prototype.finish=function(t){var i,e;if(this._dragging)return e=this._dragging.parent(),this._placeholder.detach(),i=this._dragging.index(),this._dragging.removeClass("dragging").show(),(i!==this._original_index||e.get(0)!==this._original_parent.get(0))&&e.trigger("sorted",this._dragging,{old_index:this._original_index,new_index:i,old_parent:this._original_parent,new_parent:e}),this._dragging=null},e}()})}.call(this),function(){var t=[].slice;jQuery(function(i){return i.makeGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i,e;return i=16*Math.random()|0,e="x"===t?i:3&i|8,e.toString(16)})},i.urlParam=function(t){var i;return i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.href),i?i[1]||null:!1},i.fn.sendCommand=function(t,i){return this.each(function(){var e;return e=JSON.stringify({event:"command",func:t,args:i||[],id:this.id}),this.contentWindow.postMessage(e,"*")})},i.fn.trigger_change_on_deselect=function(){return this.each(function(){var t,e;return t=i(this),e=t.attr("name"),i("input[name='"+e+"']:radio").not(t).change(function(){return i(this).is(":checked")?t.change():void 0})})},i.easing.glide=function(t,i,e,n,s){return-n*((i=i/s-1)*i*i*i-1)+e},i.easing.boing=function(t,i,e,n,s,r){return null==r&&(r=1.70158),n*((i=i/s-1)*i*((r+1)*i+r)+1)+e},i.easing.expo=function(t,i,e,n,s){var r;return null!=(r=i===s)?r:e+{c:n*(-Math.pow(2,-10*i/s)+1)+e}},i.add_stylesheet=function(t){return document.createStyleSheet?document.createStyleSheet(t):i("head").append('<link rel="stylesheet" href="'+t+'" type="text/css" />')},i.namespace=function(i,e,n){var s,r,o,a,h,l;for(arguments.length<3&&(a=["undefined"!=typeof exports?exports:window].concat(t.call(arguments)),i=a[0],e=a[1],n=a[2]),l=i,h=e.split("."),s=0,o=h.length;o>s;s++)r=h[s],i=i[r]||(i[r]={});return n(i,l)},i.fn.find_including_self=function(t){var i;return i=this.find(t),this.is(t)&&i.push(this),i},i.fn.self_or_ancestor=function(t){return this.is(t)?this:this.parents(t)},i.ajaxError=function(t){return function(t,i,e){console.error("...error!",t,i,e),trigger("error",i,e)}}(this),i.fn.flash=function(){return this.each(function(){var t;return t=i(this),t.fadeIn("fast"),i('<a href="#" class="closer">close</a>').prependTo(t),t.bind("click",function(i){return i.preventDefault(),t.fadeOut("fast")})})},i.fn.disappearAfter=function(t){return i(this).fadeOut("slow",function(){return i(this).remove()})},i.fn.signal=function(t,e){return null==t&&(t="#f7f283"),null==e&&(e=1e3),this.each(function(){return i(this).css("backgroundColor",t).animate({backgroundColor:"#ffffff"},e)})},i.fn.signal_confirmation=function(){return this.signal("#c7ebb4")},i.fn.signal_error=function(){return this.signal("#e55a51")},i.fn.signal_cancellation=function(){return this.signal("#a2a3a3")},i.fn.back_button=function(){return this.click(function(t){return t&&t.preventDefault(),history.back(),!0})},i.activations=[],i.activate_with=function(t){return i.activations.push(t)},i.fn.activate=function(){var t,e,n,s;for(s=i.activations,e=0,n=s.length;n>e;e++)t=s[e],t.apply(this);return this},i.fn.editable=function(){return this.each(function(){var t,e;return e=i(this),e.attr("contentEditable",!0),null!=e.attr("data-plain")&&this.addEventListener("paste",function(t){var i;return t.preventDefault(),i=t.clipboardData.getData("text/plain"),document.execCommand("insertHTML",!1,i)}),null!=e.attr("data-toolbar")?(t=e.is("div")?["bold","italic","underline","strikethrough","anchor","orderedlist","unorderedlist","header1","header2","quote"]:["bold","italic","underline","strikethrough","anchor"],new MediumEditor(this,{placeholder:"",targetBlank:!0,cleanPastedHTML:!0,buttons:t})):void 0}),this},i.fn.ineditable=function(){return this.each(function(){return i(this).attr("contentEditable",!1)}),this},i.fn.enable=function(){return this.each(function(){var t;return t=i(this).find(".disabled"),i(this).removeClass("disabled").addClass("enabled").attr("disabled",!1).find("input, select, textarea").attr("disabled",!1),t.disable()})},i.fn.disable=function(){return this.each(function(){var t;return t=i(this).find(".enabled"),i(this).addClass("disabled").removeClass("enabled").attr("disabled",!0).find("input, select, textarea").attr("disabled",!0),t.enable()})}})}.call(this),function(){var t=function(t,i){return function(){return t.apply(i,arguments)}},i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty;jQuery(function(e){var n,s,r,o,a,h,l,u;return e.fn.flash=function(){return this.each(function(){var t;return t=e(this),t.fadeIn("fast"),e('<a href="#" class="closer">close</a>').prependTo(t).bind("click",function(i){return i.preventDefault(),t.slideUp("normal")})})},e.fn.expander=function(t){return this.each(function(){return new s(this,t)}),this},s=function(){function i(i){this.show=t(this.show,this),this.hide=t(this.hide,this),this.toggle=t(this.toggle,this),this.set=t(this.set,this),this.link=e(i),this.toggled=e(this.link.attr("data-affected")),this.set(),this.link.click(this.toggle)}return i.prototype.set=function(){return this.link.hasClass("open")?this.show():this.hide()},i.prototype.toggle=function(t){return t&&t.preventDefault(),this.link.hasClass("open")?this.hide():this.show()},i.prototype.hide=function(){return this.link.removeClass("open"),this.toggled.stop().slideUp({duration:"slow",easing:"glide"})},i.prototype.show=function(){return this.link.addClass("open"),this.toggled.stop().slideDown({duration:"normal",easing:"boing"})},i}(),n=function(){function i(i){this.hide=t(this.hide,this),this.show=t(this.show,this),this.toggle=t(this.toggle,this),this.contain=t(this.contain,this),this._container=e(i),this._trigger=this._container.find("a"),this._field=this._container.find("input"),this._holder=this._container.find("div.kal"),this._mon=this._container.find("span.mon"),this._dom=this._container.find("span.dom"),this._year=this._container.find("span.year"),this._kal=new Kalendae(this._holder[0]),this._holder.hide(),this._trigger.click(this.toggle),this._container.click(this.contain),this._kal.subscribe("change",function(t){return function(){var i,e,n,s;return t.hide(),t._field.val(t._kal.getSelected()),n=t._kal.getSelected().split("-"),s=n[0],e=n[1],i=n[2],t._year.text(s),t._dom.text(i),t._mon.text(Kalendae.moment.monthsShort[parseInt(e,10)-1])}}(this))}return i.prototype.contain=function(t){return t?t.stopPropagation():void 0},i.prototype.toggle=function(t){return t&&t.preventDefault(),this._holder.is(":visible")?this.hide():this.show()},i.prototype.show=function(){return this._holder.fadeIn("fast",function(t){return function(){return t._container.addClass("editing"),e(document).bind("click",t.hide)}}(this))},i.prototype.hide=function(){return e(document).unbind("click",this.hide),this._container.removeClass("editing"),this._holder.fadeOut("fast")},i}(),e.fn.date_picker=function(){return this.each(function(){return new n(this)}),this},u=function(){function i(i){this.hide=t(this.hide,this),this.show=t(this.show,this),this.change=t(this.change,this),this.select=t(this.select,this);var n,s,r;for(this.field=e(i),this.holder=e('<div class="timepicker" />'),this.dropdown=new Dropdown(this.field,{on_select:this.select,on_keyup:this.change}),r=[],n=s=0;24>=s;n=++s)r.push({value:n+":00"}),r.push({value:n+":30"});this.dropdown.populate(r),this.field.focus(this.show),this.field.blur(this.hide)}return i.prototype.select=function(t){return this.field.val(t),this.field.trigger("change")},i.prototype.change=function(t){return this.dropdown.match(this.field.val())},i.prototype.show=function(t){return this.dropdown.show()},i.prototype.hide=function(t){return this.dropdown.hide()},i}(),e.fn.time_picker=function(){return this.each(function(){return new u(this)})},e.fn.slug_field=function(){return this.each(function(){return new l(this)})},l=function(){function i(i,n){this.unwait=t(this.unwait,this),this.wait=t(this.wait,this),this.showAvailability=t(this.showAvailability,this),this.checkAvailability=t(this.checkAvailability,this),this.valid=t(this.valid,this),this.check=t(this.check,this),this.val=t(this.val,this),this.options=e.extend({min:3,match:/^\w+$/},n),this.field=e(i),this.notice=e(".availability"),this.form=this.field.parents("form"),this.submit=this.form.find(".submit"),this.field.keyup(this.check),this.request=null}return i.prototype.val=function(){return this.field.val()},i.prototype.check=function(){return this.val=this.field.val(),this.valid()?(this.notice.removeClass("invalid"),this.checkAvailability()):(this.notice.addClass("invalid").text("Please enter three or more letters and digits"),this.submit.addClass("unavailable"))},i.prototype.valid=function(){return this.val.length>=this.options.min&&this.options.match.test(this.val)},i.prototype.checkAvailability=function(){var t;return this.wait(),null!=(t=this.request)&&t.abort(),this.request=e.getJSON("/check/"+this.val+".json",this.showAvailability)},i.prototype.showAvailability=function(t){return this.unwait(),t?(this.notice.text("This address is available"),this.notice.addClass("available").removeClass("unavailable"),this.field.addClass("available").removeClass("unavailable"),this.submit.removeClass("unavailable")):(this.notice.text("This address is already in use"),this.notice.addClass("unavailable").removeClass("available"),this.field.addClass("unavailable").removeClass("available"),this.submit.addClass("unavailable"))},i.prototype.wait=function(){return this.notice.addClass("waiting")},i.prototype.unwait=function(){return this.notice.removeClass("waiting")},i}(),e.fn.password_form=function(){return this.each(function(){return new a(this)})},a=function(){function i(i,n){this.submitIfValid=t(this.submitIfValid,this),this.unsubmittable=t(this.unsubmittable,this),this.submittable=t(this.submittable,this),this.checkPassword=t(this.checkPassword,this),this.checkForm=t(this.checkForm,this),this.options=e.extend({length:6},n),this.form=e(i),this.password_field=this.form.find("input.password"),this.confirmation_field=this.form.find("input.password_confirmation"),this.fields=this.form.find("input"),this.confirmation_holder=this.confirmation_field.parents("p"),this.submit=this.form.find(".submit"),this.required=this.password_field.attr("required"),this.fields.bind("keyup",this.checkForm),this.password_field.bind("keyup",this.checkPassword),this.fields.bind("invalid",this.invalidField),this.form.bind("submit",this.submitIfValid),this.fields.attr("data-strict",!1),this.unsubmittable(),this.confirmation_holder.hide()}return i.prototype.checkForm=function(){return this.fields.removeClass("invalid").addClass("valid"),this.form.get(0).checkValidity()?this.submittable():this.unsubmittable()},i.prototype.invalidField=function(){var t;return t=e(this),t.removeClass("valid"),t.addClass(!t.attr("data-strict")&&!t.val()||""===t.val()?"empty":"invalid")},i.prototype.checkPassword=function(){return""!==this.password_field.val()||this.required?(this.confirmation_field.attr("pattern",this.password_field.val()).attr("required",!0),this.password_field.get(0).checkValidity()?this.confirmation_holder.show():this.confirmation_holder.hide()):(this.confirmation_field.attr("pattern","").attr("required",!1),this.confirmation_holder.hide())},i.prototype.submittable=function(){return this.submit.removeClass("unavailable"),this.blocked=!1},i.prototype.unsubmittable=function(){return this.submit.addClass("unavailable"),this.blocked=!0},i.prototype.submitIfValid=function(t){return this.fields.attr("data-strict",!0),this.checkForm(),this.blocked?t.preventDefault():(this.submit.val("please wait"),this.unsubmittable())},i}(),e.fn.folder=function(){return this.each(function(){return new r(this)})},r=function(){function i(i){this.hide=t(this.hide,this),this.show=t(this.show,this),this.toggle=t(this.toggle,this),this.set=t(this.set,this),this._container=e(i),this._list=this._container.children("ul.filing"),this._list[0]&&(this._container.children("a.folder").click(this.toggle),this.set())}return i.prototype.set=function(t){return t&&t.preventDefault(),this._container.hasClass("open")?this.show():this.hide()},i.prototype.toggle=function(t){return t&&(t.preventDefault(),t.stopPropagation()),this._container.hasClass("open")?this.hide():this.show()},i.prototype.show=function(t){return t&&t.preventDefault(),this._container.addClass("open"),this._list.stop().slideDown("fast")},i.prototype.hide=function(t){return t&&t.preventDefault(),this._list.stop().slideUp("normal",function(t){return function(){return t._container.removeClass("open")}}(this))},i}(),e.fn.sliding_link=function(){return this.each(function(){return new h(this)})},h=function(){function i(i){this.cleanup=t(this.cleanup,this),this.sweep=t(this.sweep,this),this.receive=t(this.receive,this),this.defaultSelector=t(this.defaultSelector,this),this.getDirection=t(this.getDirection,this),this.getPage=t(this.getPage,this),this._link=e(i),this._selector=this._link.attr("data-affected")||this.defaultSelector(),this._direction=this.getDirection(),this._page=this.getPage(),this._frame=this._page.parents(".scroller").first(),this._frame.length||(this._page.wrap(e('<div class="scroller" />')),this._frame=this._page.parent()),this._viewport=this._frame.parents(".scrolled").first(),this._viewport.length||(this._frame.wrap(e('<div class="scrolled" />')),this._viewport=this._frame.parents(".scrolled")),this._width=this._page.width(),this._link.remote({on_success:this.receive})}return i.prototype.getPage=function(){return this._link.parents(this._selector).first()},i.prototype.getDirection=function(){return this._link.attr("data-direction")},i.prototype.defaultSelector=function(){return".scrap"},i.prototype.receive=function(t){var i;return i=e(t),this.sweep(i),i.activate()},i.prototype.sweep=function(t){return this._old_page=this._page,this._viewport.css("overflow","hidden"),"right"===this._direction?(this._frame.append(t),this._viewport.animate({scrollLeft:this._width},"slow","glide",this.cleanup)):(this._frame.prepend(t),this._viewport.scrollLeft(this._width).animate({scrollLeft:0},"slow","glide",this.cleanup))},i.prototype.cleanup=function(){return this._viewport.scrollLeft(0),this._old_page.remove()},i}(),e.fn.page_turner=function(){return this.each(function(){return new o(this)})},o=function(e){function n(i){this.getDirection=t(this.getDirection,this),this.defaultSelector=t(this.defaultSelector,this),n.__super__.constructor.apply(this,arguments),this._page_number=parseInt(this._link.parent().siblings(".current").text())}return i(n,e),n.prototype.defaultSelector=function(){return".paginated"},n.prototype.getDirection=function(){return this._direction=this._link.attr("rel")?"next"===this._link.attr("rel")?"right":"left":parseInt(this._link.text())>this._page_number?"right":"left"},n}(h)})}.call(this);