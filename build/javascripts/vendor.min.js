(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},n=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;window.MapStick=function(){return{extend:Backbone.Model.extend}},MapStick.ChildViewContainer=function(){function e(e){this._updateLength=t(this._updateLength,this),this.apply=t(this.apply,this),this.call=t(this.call,this),this.remove=t(this.remove,this),this.findByCid=t(this.findByCid,this),this.findByIndex=t(this.findByIndex,this),this.findByCustom=t(this.findByCustom,this),this.findByModelCid=t(this.findByModelCid,this),this.findByModel=t(this.findByModel,this),this.add=t(this.add,this),this._views={},this._indexByModel={},this._indexByCustom={},this._methods=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"],_.each(this._methods,function(t){return function(n){return t[n]=function(){var r;return e=_.values(t._views),r=[e].concat(_.toArray(arguments)),_[n].apply(_,r)}}}(this)),this._updateLength(),_.each(e,this.add)}return e.prototype.add=function(t,e){var n,r;return r=t.cid,this._views[r]=t,(n=t.model)&&(this._indexByModel[n.cid]=r),e&&(this._indexByCustom[e]=r),this._updateLength(),this},e.prototype.findByModel=function(t){return this.findByModelCid(t.cid)},e.prototype.findByModelCid=function(t){var e;return e=this._indexByModel[t],this.findByCid(e)},e.prototype.findByCustom=function(t){var e;return e=this._indexByCustom[t],this.findByCid(e)},e.prototype.findByIndex=function(t){return _.values(this._views)[t]},e.prototype.findByCid=function(t){return this._views[t]},e.prototype.remove=function(t){var e;return e=t.cid,t.model&&delete this._indexByModel[t.model.cid],_.any(this._indexByCustom,function(t){return function(n,r){return n===e?(delete t._indexByCustom[r],!0):void 0}}(this),this),delete this._views[e],this._updateLength(),this},e.prototype.call=function(t){return this.apply(t,_.tail(arguments))},e.prototype.apply=function(t,e){return _.each(this._views,function(n){return function(n){return _.isFunction(n[t])?n[t].apply(n,e||[]):void 0}}(this))},e.prototype._updateLength=function(){return this.length=_.size(this._views)},e}(),MapStick.getOption=function(t,n){return t&&n?t.options&&e.call(t.options,n)>=0&&void 0!==t.options[n]?t.options[n]:t[n]:null},MapStick.triggerMethod=function(){var t,e;return t=/(^|:)(\w)/gi,getEventName(match,prefix,eventName)(function(){return eventName.toUpperCase()}),e=function(e){return function(n){var r,i;return i="on"+n.replace(t,getEventName),r=e[i],_.isFunction(e.trigger)&&e.trigger.apply(e,arguments),_.isFunction(r)?r.apply(e,_.tail(arguments)):void 0}}(this)},MapStick.actAsCollection=function(t,e){var n;return n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"],_.each(n,function(n){return function(r){return t[r]=function(){var t,i;return i=_.values(_.result(n,e)),t=[i].concat(_.toArray(arguments)),_[r].apply(_,t)}}}(this))},MapStick.decodePathString=function(t){return google.maps.geometry?t&&_.isString(t)&&""!==t?google.maps.geometry.encoding.decodePath(t):[]:console.error("please include google.maps.geometry library")},MapStick.encodePathString=function(t){return google.maps.geometry?t?google.maps.geometry.encoding.encodePath(t):void 0:console.error("please include google.maps.geometry library")},MapStick.isClockwise=function(t){var e,n,r,i;return _.isArray(t)||(t=t.getArray()),t.push(t[0]),e=0,i=0,n=null,r=null,_.each(t,function(t){var o,s;return s=t.lng(),o=t.lat(),r&&n&&(e+=s*n,i+=o*r),r=s,n=o}),e-i>0},MapStick.Overlay=function(e){function r(e){null==e&&(e={}),this.updateFromDrawn=t(this.updateFromDrawn,this),this.getDrawnOptions=t(this.getDrawnOptions,this),this.finishDrawing=t(this.finishDrawing,this),this.draw=t(this.draw,this),this.render=t(this.render,this),this.clearListeners=t(this.clearListeners,this),this.remove=t(this.remove,this),this.hide=t(this.hide,this),this.show=t(this.show,this),this.set=t(this.set,this),this.get=t(this.get,this),this.triggerOverlayEvent=t(this.triggerOverlayEvent,this),this.setBoundOverlayAttributes=t(this.setBoundOverlayAttributes,this),this.setBoundModelAttributes=t(this.setBoundModelAttributes,this),this.listenToBoundOverlayEvents=t(this.listenToBoundOverlayEvents,this),this.listenToBoundModelChanges=t(this.listenToBoundModelChanges,this),this.bindPosition=t(this.bindPosition,this),this.setBindings=t(this.setBindings,this),this.listenToModel=t(this.listenToModel,this),this.attachOverlayEvents=t(this.attachOverlayEvents,this),this.buildOverlay=t(this.buildOverlay,this),this.googleDrawingOverlayType=t(this.googleDrawingOverlayType,this),this.googleOverlayType=t(this.googleOverlayType,this),this.cid=_.uniqueId("overlay"),this.options=_.extend({},_.result(this,"options"),_.isFunction(e)?e.call(this):e),this.overlayOptions=_.pick(e,this.properties),_.defaults(this.overlayOptions,this.defaultOptions),this[this.overlayType]=this.overlay=this.buildOverlay(this.overlayOptions),_.extend(this,_.pick(e,this.viewOptions)),this.attachOverlayEvents(),this.listenToModel(),this.setBindings(),_.isFunction(this.initialize)&&this.initialize(this.options),this.model.on("destroy",this.remove),this.model.on("draw",this.draw)}return n(r,e),r.prototype.googleOverlayType=function(){return this.overlayType.split("_").map(function(t){return t.charAt(0).toUpperCase()+t.slice(1)}).join("")},r.prototype.googleDrawingOverlayType=function(){return google.maps.drawing.OverlayType[""+this.overlayType.split("_").map(function(t){return t.toUpperCase()}).join("")]},r.prototype.defaultOptions={},r.prototype.properties=[],r.prototype.overlayEvents={},r.prototype.viewOptions=["model","events","map"],r.prototype.bindings={},r.prototype.defaultOverlayEvents=[],r.prototype.modelEvents={},r.prototype.triggerMethod=Marionette.triggerMethod,r.prototype.showing=!1,r.prototype.buildOverlay=function(t){return new(google.maps[this.googleOverlayType()])(t)},r.prototype.attachOverlayEvents=function(){return _.each(this.overlayEventNames,function(t){return function(e){return google.maps.event.addListener(t.overlay,e,function(n){return _.isFunction(t.trigger)&&t.trigger(e,n),t.triggerOverlayEvent(e,n)})}}(this))},r.prototype.listenToModel=function(){return this.model?_.each(this.modelEvents,function(t){return function(e,n){var r;return _.isFunction(r=t[e])?t.model.on(n,r):void 0}}(this)):void 0},r.prototype.setBindings=function(){return _.each(this.bindings,function(t){return function(e,n){var r;if(_.isString(e)&&(e={attribute:e,overlayChanged:!0}),_.isObject(e)){if(e.overlay_attribute=n,"position"===n&&_.isString(e.lat)&&_.isString(e.lng))return t.bindPosition(e);if(r=e.attributes||e.attribute)return _.isString(r)&&(e.attributes=r=[r]),t.setBoundOverlayAttributes(e),t.listenToBoundModelChanges(e),t.listenToBoundOverlayEvents(e)}}}(this))},r.prototype.bindPosition=function(t){var e,n,r,i;return null==t&&(t={}),e=t.lat,n=t.lng,i=function(t){return function(){return t.model.has(e)&&t.model.has(n)?t.set({position:new google.maps.LatLng(t.model.get(e),t.model.get(n))}):void 0}}(this),i(),this.model.on("change:"+e+" change:"+n,function(t){return function(t,e,n){var r;return r=(null!=n?n:{}).mapstickChange,r?void 0:i()}}(this)),r=t.overlayEvents||this.defaultOverlayEvents,_.each(r,function(t){return function(r){return google.maps.event.addListener(t.overlay,r,function(r){var i,o;return(o=t.get("position"))?(i={},i[e]=o.lat(),i[n]=o.lng(),t.model.set(i,{mapstickChange:!0})):void 0})}}(this))},r.prototype.listenToBoundModelChanges=function(t){var e,n;return null==t&&(t={}),e=t.attributes,n=e.map(function(t){return"change:"+t}).join(" "),this.model.on(n,function(e){return function(n,r,i){var o;return o=(null!=i?i:{}).mapstickChange,o?void 0:e.setBoundOverlayAttributes(t)}}(this))},r.prototype.listenToBoundOverlayEvents=function(t){var e,n;return null==t&&(t={}),n=t.overlay_attribute,(e=t.overlayEvents)?_.isString(e)&&(e=[e]):e||(e=this.defaultOverlayEvents),_.each(e,function(e){return function(r){return google.maps.event.addListener(e.overlay,r,function(i){return"drawn"===r&&("paths"===n?e._listenToPaths(t):"path"===n&&e._listenToPath(t)),e.setBoundModelAttributes(t,i)})}}(this))},r.prototype.setBoundModelAttributes=function(t,e){var n,r,i,o,s;return null==t&&(t={}),t.overlayChanged?(o=t.overlay_attribute,r=t.attributes,n="paths"===o?this.overlay.getPaths():"path"===o?this.overlay.getPath():this.get(o),s={},i=t.overlayChanged,_.isFunction(i)?s=i(n,e):_.isString(i)&&_.isFunction(this[i])?s=this[i](n,e):i===!0&&1===r.length&&(s[r[0]]=n),this.model.set(s,{mapstickChange:!0})):void 0},r.prototype.setBoundOverlayAttributes=function(t){var e,n,r,i,o,s;return null==t&&(t={}),e=t.attributes,i=t.overlay_attribute,n={},_.each(e,function(t){return function(e){return n[e]=t.model.get(e)}}(this)),o={},(r=t.modelChanged)?(s=null,_.isFunction(r)?s=r(n):_.isFunction(this[r])&&(s=this[r](n)),o[i]=s):1===e.length&&(o[i]=this.model.get(e[0])),this.set(o),"paths"===i?this._listenToPaths(t):"path"===i?this._listenToPath(t):void 0},r.prototype.triggerOverlayEvent=function(t,e){var n,r;return(n=this.overlayEvents[t])&&(r=this[n],_.isFunction(r)?r(e):console.error("no such handler for event: '"+t+"'")),r=this["on"+t.split("_").map(function(t){return t.charAt(0).toUpperCase()+t.slice(1)}).join("")],_.isFunction(r)?r(e):void 0},r.prototype.get=function(t){return this.overlay.get(t)},r.prototype.set=function(t,e){return _.isObject(t)?this.overlay.setOptions(t):_.isString(t)?this.overlay.set(t,e):console.error("can't set that")},r.prototype.show=function(t){return this.showing=!0,t&&(this.map=t),this.set("map",this.map)},r.prototype.hide=function(){return this.showing=!1,this.set("map",null)},r.prototype.remove=function(){return this.clearListeners(),this.set("map",null)},r.prototype.clearListeners=function(){return this.overlay?google.maps.event.clearListeners(this.overlay):void 0},r.prototype.render=function(){return this.showing?this.overlay.setMap(this.map):void 0},r.prototype.draw=function(t){return null==t&&(t=this.map),google.maps.drawing?(null==MapStick.drawingManager&&(MapStick.drawingManager=new google.maps.drawing.DrawingManager({map:t,drawingControl:!1})),MapStick.drawingManager.setDrawingMode(this.overlayType),google.maps.event.clearInstanceListeners(MapStick.drawingManager),google.maps.event.addListener(MapStick.drawingManager,"overlaycomplete",function(t){return function(e){return t.finishDrawing(e.overlay)}}(this))):console.error("please include google.maps.drawing library")},r.prototype.finishDrawing=function(t){return this.updateFromDrawn(t),t.setMap(null),MapStick.drawingManager.setDrawingMode(null)},r.prototype.getDrawnOptions=function(t){return{}},r.prototype.updateFromDrawn=function(t){return this.overlay.setOptions(this.getDrawnOptions(t)),this.model.trigger("overlay:drawn"),google.maps.event.trigger(this.overlay,"drawn")},r}(Backbone.View),MapStick.Marker=function(e){function r(){return this.getDrawnOptions=t(this.getDrawnOptions,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.overlayType="marker",r.prototype.overlayEventNames=["animation_changed","click","clickable_changed","cursor_changed","dblclick","drag","dragend","draggable_changed","dragstart","flat_changed","icon_changed","mousedown","mouseout","mouseover","mouseup","position_changed","rightclick","shape_changed","title_changed","visible_changed","zindex_changed"],r.prototype.defaultOverlayEvents=["drag","dragend","dragstart","drawn"],r.prototype.properties=["anchorPoint","animation","clickable","crossOnDrag","cursor","draggable","icon","map","opacity","optimized","position","shape","title","visible","zIndex"],r.prototype.getDrawnOptions=function(t){return{position:t.getPosition()}},r}(MapStick.Overlay),MapStick.OverlayWithPath=function(e){function r(){return this._listenToPath=t(this._listenToPath,this),this.getDrawnOptions=t(this.getDrawnOptions,this),this.setOverlayPathFromEncodedString=t(this.setOverlayPathFromEncodedString,this),this.getEncodedPathFromOverlay=t(this.getEncodedPathFromOverlay,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.defaultOptions={path:new google.maps.MVCArray},r.prototype.getEncodedPathFromOverlay=function(){return MapStick.encodePathString(this.overlay.getPath())},r.prototype.setOverlayPathFromEncodedString=function(t){return this.overlay.setPath(MapStick.decodePathString(t))},r.prototype.getDrawnOptions=function(t){return{path:t.getPath()}},r.prototype._listenToPath=function(t){var e;return null==t&&(t={}),e=this.overlay.getPath(),_.each(["insert_at","remove_at","set_at"],function(n){return function(r){return google.maps.event.addListener(e,r,function(e){return n.setBoundModelAttributes(t,e)})}}(this))},r}(MapStick.Overlay),MapStick.Polyline=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.overlayType="polyline",e.prototype.overlayEventNames=["click","dblclick","drag","dragend","dragstart","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"],e.prototype.defaultOverlayEvents=["drag","dragend","drawn"],e.prototype.properties=["clickable","draggable","editable","geodesic","icons","map","path","strokeColor","strokeOpacity","strokeWeight","visible","zIndex"],e}(MapStick.OverlayWithPath),MapStick.Polygon=function(e){function r(){return this._listenToPaths=t(this._listenToPaths,this),this.setOverlayPathsFromEncodedStrings=t(this.setOverlayPathsFromEncodedStrings,this),this.getEncodedPathsFromOverlay=t(this.getEncodedPathsFromOverlay,this),this.finishExclusion=t(this.finishExclusion,this),this.drawExclusion=t(this.drawExclusion,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.overlayType="polygon",r.prototype.overlayEventNames=["click","dblclick","drag","dragend","dragstart","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"],r.prototype.defaultOverlayEvents=["drag","dragend","drawn"],r.prototype.properties=["zIndex","visible","strokeWeight","strokePosition","strokeOpacity","strokeColor","paths","map","geodesic","fillOpacity","fillColor","editable","draggable","clickable"],r.prototype.drawExclusion=function(){return google.maps.drawing?(null==MapStick.drawingManager&&(MapStick.drawingManager=new google.maps.drawing.DrawingManager({map:this.map,drawingControl:!1})),MapStick.drawingManager.setDrawingMode("polygon"),google.maps.event.clearInstanceListeners(MapStick.drawingManager),google.maps.event.addListener(MapStick.drawingManager,"polygoncomplete",function(t){return function(e){return t.finishExclusion(e)}}(this))):console.error("please include google.maps.drawing library")},r.prototype.finishExclusion=function(t){var e,n;return e=t.getPath(),MapStick.isClockwise(e)===MapStick.isClockwise(this.overlay.getPath())&&(e=new google.maps.MVCArray(e.getArray().reverse())),n=this.overlay.getPaths(),n.push(e),this.overlay.setPaths(n),t.setMap(null),MapStick.drawingManager.setDrawingMode(null),google.maps.event.trigger(this.overlay,"drawn")},r.prototype.getEncodedPathsFromOverlay=function(){return _.collect(this.overlay.getPaths().getArray(),function(t){return function(t){return MapStick.encodePathString(t)}}(this))},r.prototype.setOverlayPathsFromEncodedStrings=function(t){return _.isString(t)&&(t=t.split(",")),t=_.collect(t,function(t){return function(t){return MapStick.decodePathString(t)}}(this)),this.overlay.setPaths(t)},r.prototype._listenToPaths=function(t){var e;return null==t&&(t={}),e=this.overlay.getPaths(),_.each(["insert_at","remove_at","set_at"],function(n){return function(r){return e.forEach(function(e){return google.maps.event.addListener(e,r,function(e){return n.setBoundModelAttributes(t)})})}}(this))},r}(MapStick.OverlayWithPath),MapStick.Rectangle=function(e){function r(){return this.getDrawnOptions=t(this.getDrawnOptions,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.overlayType="rectangle",r.prototype.overlayEventNames=["bounds_changed","click","dblclick","drag","dragend","dragstart","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"],r.prototype.defaultOverlayEvents=["drag","dragend","dragstart","drawn"],r.prototype.properties=["bounds","clickable","draggable","editable","fillColor","fillOpacity","map","strokeColor","strokeOpacity","strokePosition","strokeWeight","visible","zIndex"],r.prototype.getDrawnOptions=function(t){return{bounds:t.getBounds()}},r}(MapStick.Overlay),MapStick.Circle=function(e){function r(){return this.getDrawnOptions=t(this.getDrawnOptions,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.overlayType="circle",r.prototype.overlayEventNames=["center_changed","click","dblclick","drag","dragend","dragstart","mousedown","mousemove","mouseout","mouseup","mouseover","radius_changed","rightclick"],r.prototype.defaultOverlayEvents=["drag","dragend","dragstart","drawn"],r.prototype.properties=["center","clickable","draggable","editable","fillColor","fillOpacity","map","radius","strokeColor","strokeOpacity","strokePosition","strokeWeight","visible","zIndex"],r.prototype.getDrawnOptions=function(t){return{center:t.getCenter(),radius:t.getRadius()}},r}(MapStick.Overlay),MapStick.InfoWindow=function(e){function r(){return this.setContentView=t(this.setContentView,this),this.close=t(this.close,this),this.open=t(this.open,this),this.isOpen=t(this.isOpen,this),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.overlayType="info_window",r.prototype.overlayEventNames=["closeclick","content_changed","domready","position_changed","zindex_changed"],r.prototype.properties=["content","disableAutoPan","maxWidth","pixelOffset","position","zIndex"],r.prototype.initialize=function(t){return this.content_view=(null!=t?t:{}).content_view,r.__super__.initialize.apply(this,arguments),this.content_view?this.setContentView():void 0},r.prototype.isOpen=function(){var t;return t=this.get("map"),null!==t&&"undefined"!=typeof t},r.prototype.open=function(t){var e,n,r,i;return i=null!=t?t:{},n=i.map,e=i.anchor,r=i.position,e?this.overlay.open(n||(n=e.getMap()),e):r&&(this.overlay.setPosition(r),n||(n=this.map))?this.overlay.open(n):void 0},r.prototype.close=function(){return this.overlay.close()},r.prototype.setContentView=function(t){return null==t&&(t=this.content_view),t.render(),this.overlay.setContent(t.$el[0])},r}(MapStick.Overlay),MapStick.OverlayCollection=function(e){function r(e){this.closeChildren=t(this.closeChildren,this),this.close=t(this.close,this),this.triggerRendered=t(this.triggerRendered,this),this.triggerBeforeRender=t(this.triggerBeforeRender,this),this._initChildViewStorage=t(this._initChildViewStorage,this),this.removeChildView=t(this.removeChildView,this),this.removeItemView=t(this.removeItemView,this),this.buildItemView=t(this.buildItemView,this),this.addItemView=t(this.addItemView,this),this.getItemView=t(this.getItemView,this),this.showCollection=t(this.showCollection,this),this._renderChildren=t(this._renderChildren,this),this.render=t(this.render,this),this.hide=t(this.hide,this),this.show=t(this.show,this),this.addChildView=t(this.addChildView,this),this.removeListeners=t(this.removeListeners,this),this.listenToCollection=t(this.listenToCollection,this),this._initialEvents=t(this._initialEvents,this),this._initialCollection=t(this._initialCollection,this),this.options=_.extend({},_.result(this,"options"),_.isFunction(e)?e.call(this):e),_.extend(this,_.pick(e,this.viewOptions)),this._initChildViewStorage(),this._initialCollection(),this._initialEvents(),this.listenToCollection(),_.isFunction(this.initialize)&&this.initialize(this.options)}return n(r,e),r.prototype.itemType="model",r.prototype.triggerMethod=Marionette.triggerMethod,r.prototype.viewOptions=["collection","model","map"],r.prototype.showing=!1,r.prototype.collectionEvents={},r.prototype._initialCollection=function(){return this.collection.each(function(t){return function(e,n){var r;return(r=t.getItemView(e))?t.addItemView(e,r,n):void 0}}(this))},r.prototype._initialEvents=function(){return this.collection?(this.listenTo(this.collection,"add",this.addChildView),this.listenTo(this.collection,"remove",this.removeItemView),this.listenTo(this.collection,"reset",this.render)):void 0},r.prototype.listenToCollection=function(){return this.collection?_.each(this.collectionEvents,function(t){return function(e,n){var r;return _.isFunction(r=t[e])?t.collection.on(n,r):void 0}}(this)):void 0},r.prototype.removeListeners=function(){return this.collection?(this.stopListening(this.collection,"add"),this.stopListening(this.collection,"remove"),this.stopListening(this.collection,"reset")):void 0},r.prototype.addChildView=function(t,e,n){var r;return(r=this.getItemView(t))?this.addItemView(t,r):void 0},r.prototype.show=function(t){return this.showing=!0,t&&(this.map=t),this.children.apply("show")},r.prototype.hide=function(){return this.showing=!1,this.children.apply("hide")},r.prototype.render=function(){return this.isClosed=!1,this.triggerBeforeRender(),this._renderChildren(),this.triggerRendered(),this},r.prototype._renderChildren=function(){return this.closeChildren(),this.showCollection()},r.prototype.showCollection=function(){return this.collection.each(function(t){return function(e){var n;return(n=t.getItemView(e))?t.addItemView(e,n):void 0}}(this))},r.prototype.getItemView=function(t){var e;return e=MapStick.getOption(this,"itemView"),e||console.error("An 'itemView' must be specified for class: "+this.constructor.name),e},r.prototype.addItemView=function(t,e,n){var r,i;return r=MapStick.getOption(this,"itemViewOptions"),_.isFunction(r)&&(r=r.call(this,t,n)),i=this.buildItemView(t,e,r),this.triggerMethod("before:item:added",i),this.children.add(i),this.showing?i.show():i.hide(),this.triggerMethod("after:item:added",i),i},r.prototype.buildItemView=function(t,e,n){var r,i;return r=_.extend({model:t,map:this.map},n),i=new e(r)},r.prototype.removeItemView=function(t){var e;return e=this.children.findByModel(t),this.removeChildView(e)},r.prototype.removeChildView=function(t){return t&&(t.close?t.close():t.remove&&t.remove(),this.stopListening(t),this.children.remove(t)),this.triggerMethod("item:removed",t)},r.prototype._initChildViewStorage=function(){return this.children=new MapStick.ChildViewContainer},r.prototype.triggerBeforeRender=function(){return this.triggerMethod("before:render",this),this.triggerMethod("collection:before:render",this)},r.prototype.triggerRendered=function(){return this.triggerMethod("render",this),this.triggerMethod("collection:rendered",this)},r.prototype.close=function(){return this.isClosed?void 0:(this.triggerMethod("collection:before:close"),this.closeChildren(),this.removeListeners(),this.triggerMethod("collection:closed"))},r.prototype.closeChildren=function(){return this.children.each(function(t){return function(e,n){return t.removeChildView(e)}}(this))},r}(Backbone.View)}).call(this),function(){jQuery(function(t){var e,n,r;return n={create:"POST",update:"PUT","delete":"DELETE",read:"GET"},e=function(t){return t&&t.url?_.isFunction(t.url)?t.url():t.url:null},r=function(){throw new Error("A 'url' property or function must be specified")},Backbone.sync=function(i,o,s){var l,a,u,c,h,p;return p=n[i],c=_.extend({type:p,dataType:"json",beforeSend:function(e){var n;return s.noCSRF||(n=t('meta[name="csrf-token"]').attr("content"),n&&e.setRequestHeader("X-CSRF-Token",n)),o.trigger("sync:start")}},s),c.url||(c.url=e(o)||r()),c.data||!o||"create"!==i&&"update"!==i||(c.contentType="application/json",a={},o.paramRoot?a[o.paramRoot]=o.toJSON():a=o.toJSON(),c.data=JSON.stringify(a)),"GET"!==c.type&&(c.processData=!1),l=s.complete,c.complete=function(t,e){return o.trigger("sync:end"),l?l(t,e):void 0},h=s.success,c.success=function(t){return h&&h(o,t,s),o.trigger("sync",o,t,s)},u=s.error,c.error=function(t){return u&&u(o,t,s),o.trigger("error",o,t,s)},t.ajax(c)}})}.call(this),function(){var t,e,n,r,i,o,s,l,a,u,c={}.hasOwnProperty,h=[].slice,p=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},g=function(t,e){return function(){return t.apply(e,arguments)}};try{t=null!=(a="undefined"!=typeof module&&null!==module?require("backbone"):this.Backbone)?a:null}catch(f){s=f,t=null}u={toString:function(t){return Object.prototype.toString.call(t)},isPlainObject:function(t){return u.isObject(t)&&t.__proto__===Object.prototype},isObject:function(t){return t&&"object"==typeof t},isError:function(t){return t instanceof Error},isDate:function(t){return"[object Date]"===u.toString(t)},isArguments:function(t){return"[object Arguments]"===u.toString(t)},isFunction:function(t){return"[object Function]"===u.toString(t)},isRegExp:function(t){return"[object RegExp]"===u.toString(t)},isArray:function(t){return null!=Array.isArray?Array.isArray(t):"[object Array]"===u.toString(t)},isNumber:function(t){return"number"==typeof t||"[object Number]"===u.toString(t)},isString:function(t){return"string"==typeof t||"[object String]"===u.toString(t)},isBoolean:function(t){return t===!0||t===!1||"[object Boolean]"===u.toString(t)},isNull:function(t){return null===t},isUndefined:function(t){return"undefined"==typeof t},isDefined:function(t){return"undefined"!=typeof t},isEmpty:function(t){return null!=t},isObjectEmpty:function(t){var e,n,r;e=!0;for(n in t)if(c.call(t,n)){r=t[n],e=!1;break}return e},isComparable:function(t){return u.isNumber(t)||u.isDate(t)},isEqual:function(t,e){return JSON.stringify(t)===JSON.stringify(e)},clone:function(){var t;return t=1<=arguments.length?h.call(arguments,0):[],u.shallowExtendPlainObjects.apply(u,[{}].concat(h.call(t)))},extend:function(){var t;return t=1<=arguments.length?h.call(arguments,0):[],u.shallowExtendPlainObjects.apply(u,t)},shallowExtendPlainObjects:function(){var t,e,n,r,i,o,s;for(o=arguments[0],i=2<=arguments.length?h.call(arguments,1):[],t=0,n=i.length;n>t;t++){r=i[t],r||(r={});for(e in r)c.call(r,e)&&(s=r[e],o[e]=s)}return o},get:function(t,e){var n;return n=null!=t.get?t.get(e):t[e]},safeRegex:function(t){return t===!1?"false":t===!0?"true":null===t?"null":(t||"").replace("(.)","\\$1")},createRegex:function(t){return new RegExp(t,"ig")},createSafeRegex:function(t){return u.createRegex(u.safeRegex(t))},toArray:function(t){var e,n,r,i;if(r=[],i="undefined"!=typeof t)if(u.isArray(t))r=t.slice();else if(u.isObject(t))for(n in t)c.call(t,n)&&(e=t[n],r.push(e));else r.push(t);return r},toArrayGroup:function(t){var e,n,r,i,o;if(i=[],o="undefined"!=typeof t)if(u.isArray(t))i=t.slice();else if(u.isObject(t))for(n in t)c.call(t,n)&&(e=t[n],r={},r[n]=e,i.push(r));else i.push(t);return i},generateComparator:function(t){var e;return(e=function(t){if(t){if(u.isFunction(t))return t;if(u.isArray(t))return function(n,r){var i,o,s,l,a;for(i=0,s=o=0,l=t.length;l>o;s=++o)if(a=t[s],i=e(a)(n,r))return i;return i};if(u.isObject(t))return function(e,n){var r,i,o,s,l;o=0;for(s in t)if(c.call(t,s)&&(l=t[s],r=u.get(e,s),i=u.get(n,s),r===i?o=0:i>r?o=-1:r>i&&(o=1),-1===l&&(o*=-1),o))return o;return o};throw new Error("Unknown comparator type")}throw new Error("Cannot sort without a comparator")})(t)}},n=function(t){function e(t){var e,n,r,i;for(t=u.toArray(t),r=e=0,i=t.length;i>e;r=++e)n=t[r],this.push(n)}return p(e,t),e.prototype.hasIn=function(t){var e,n,r;for(t=u.toArray(t),e=0,n=this.length;n>e;e++)if(r=this[e],d.call(t,r)>=0)return!0;return!1},e.prototype.hasAll=function(t){var e,n,r,i,o;for(t=u.toArray(t),e=!0,i=!0,n=0,r=this.length;r>n;n++)o=this[n],e=!1,d.call(t,o)<0&&(i=!1);return e&&(i=!1),i},e.prototype.isSame=function(t){var e;return t=u.toArray(t),e=this.sort().join()===t.sort().join()},e}(Array),o=null==t?null:function(n){function r(){return this.onParentReset=g(this.onParentReset,this),this.onParentAdd=g(this.onParentAdd,this),this.onParentRemove=g(this.onParentRemove,this),this.onParentChange=g(this.onParentChange,this),this.onChange=g(this.onChange,this),r.__super__.constructor.apply(this,arguments)}return p(r,n),r.prototype.model=t.Model,r.prototype.initialize=function(t,n){var r,i,o,s;i=this,null==this.options&&(this.options={}),o=e.prototype;for(r in o)c.call(o,r)&&(s=o[r],null==this[r]&&(this[r]=s));return null!=this.comparator&&this.setComparator(this.comparator),this.applyCriteriaOptions(n),null!=n&&(null!=n.parentCollection&&(this.options.parentCollection=n.parentCollection),null!=n.live&&(this.options.live=n.live),this.live()),this},r.prototype.getComparator=function(){return this.comparator},r.prototype.setComparator=function(t){return t=u.generateComparator(t),this.comparator=t,this},r.prototype.createChildCollection=function(t,e){var n;return e||(e={}),e.parentCollection=this,null==e.collection&&(e.collection=this.collection||r),null==e.comparator&&(e.comparator=e.collection.prototype.comparator||this.comparator),n=new e.collection(t,e)},r.prototype.createLiveChildCollection=function(t,e){var n;return e||(e={}),e.live=!0,n=this.createChildCollection(t,e)},r.prototype.hasParentCollection=function(){return null!=this.options.parentCollection},r.prototype.getParentCollection=function(){return this.options.parentCollection},r.prototype.setParentCollection=function(t,e){return e||this.options.parentCollection!==t?(this.options.parentCollection=t,this.live(),this):this},r.prototype.hasModel=function(t){var e,n,r;return t||(t={}),e=null!=t.id&&this.get(t.id)?!0:null!=t.cid&&(null!=(n=null!=(r=this._byCid)?r[t.cid]:void 0)?n:this.get(t.cid))?!0:!1},r.prototype.safeRemove=function(t){var e;return e=this.hasModel(t),e&&this.remove(t),this},r.prototype.safeAdd=function(t){var e;return e=this.hasModel(t),e||this.add(t),this},r.prototype.sortCollection=function(t){if(t)t=u.generateComparator(t),this.models.sort(t);else{if(t=this.getComparator(),!t)throw new Error("You need a comparator to sort");this.models.sort(t)}return this},r.prototype.sortArray=function(t){var e;if(e=this.toJSON(),t)t=u.generateComparator(t),e.sort(t);else{if(t=this.getComparator(),!t)throw new Error("You need a comparator to sort");e.sort(t)}return e},r.prototype.findAll=function(){var t,n,r,i,o,s;return t=1<=arguments.length?h.call(arguments,0):[],t.length?1===t.length&&t[0]instanceof e?i=t[0].options:(s=t[0],r=t[1],o=t[2],i={comparator:r,paging:o,queries:{find:s}}):i=null,n=this.createChildCollection([],i).query()},r.prototype.findAllLive=function(){var t,n,r,i,o,s;return t=1<=arguments.length?h.call(arguments,0):[],t.length?1===t.length&&t[0]instanceof e?i=t[0].options:(s=t[0],r=t[1],o=t[2],i={comparator:r,paging:o,queries:{find:s}}):i=null,n=this.createLiveChildCollection([],i).query()},r.prototype.findOne=function(){var t,n,r,i,o,s;return t=1<=arguments.length?h.call(arguments,0):[],t.length?1===t.length&&t[0]instanceof e?r=t[0].options:(s=t[0],n=t[1],i=t[2],r={comparator:n,paging:i,queries:{find:s}}):r=null,o=this.testModels(this.models,r),0!==(null!=o?o.length:void 0)?o[0]:null},r.prototype.query=function(){var t,n,r;return t=1<=arguments.length?h.call(arguments,0):[],1===t.length&&(n=t[0]instanceof e?t[0].options:{paging:t[0]}),r=this.queryModels(n),this.reset(r),this},r.prototype.queryModels=function(){var t,e,n,r,i;return t=1<=arguments.length?h.call(arguments,0):[],n=this.extractCriteriaOptions.apply(this,t),e=this.getParentCollection()||this,r=e.models,i=this.testModels(r,n)},r.prototype.queryArray=function(){var t,e,n,r,i,o;for(t=1<=arguments.length?h.call(arguments,0):[],
o=[],i=this.queryModels.apply(this,t),e=0,n=i.length;n>e;e++)r=i[e],o.push(r.toJSON());return o},r.prototype.live=function(t){var e;return null==t&&(t=this.options.live),this.options.live=t,t?this.on("change",this.onChange):this.off("change",this.onChange),e=this.getParentCollection(),null!=e&&(t?(e.on("change",this.onParentChange),e.on("remove",this.onParentRemove),e.on("add",this.onParentAdd),e.on("reset",this.onParentReset)):(e.off("change",this.onParentChange),e.off("remove",this.onParentRemove),e.off("add",this.onParentAdd),e.off("reset",this.onParentReset))),this},r.prototype.add=function(e,n){var r,i,o,s;for(n=n?u.clone(n):{},e=u.isArray(e)?e.slice():[e],s=[],r=0,i=e.length;i>r;r++)o=e[r],o=this._prepareModel(o,n),o&&this.test(o)&&s.push(o);return t.Collection.prototype.add.apply(this,[s,n]),this},r.prototype.create=function(e,n){return n=n?u.clone(n):{},e=this._prepareModel(e,n),e&&this.test(e)&&t.Collection.prototype.create.apply(this,[e,n]),this},r.prototype.onChange=function(t){var e;return e=this.test(t),e?this.comparator&&this.sortCollection():this.safeRemove(t),this},r.prototype.onParentChange=function(t){var e;return e=this.test(t)&&this.getParentCollection().hasModel(t),e?this.safeAdd(t):this.safeRemove(t),this},r.prototype.onParentRemove=function(t){return this.safeRemove(t),this},r.prototype.onParentAdd=function(t){return this.safeAdd(t),this},r.prototype.onParentReset=function(t){return this.reset(this.getParentCollection().models),this},r}(t.Collection),e=function(){function t(){var t;t=1<=arguments.length?h.call(arguments,0):[],this.applyCriteriaOptions=g(this.applyCriteriaOptions,this),this.applyCriteriaOptions.apply(this,t)}return t.prototype.extractCriteriaOptions=function(){var e,n,r,i,o;return e=1<=arguments.length?h.call(arguments,0):[],1===e.length?r=e[0]instanceof t?e[0].options:e[0]?e[0]:null:e.length>1?(o=e[0],n=e[1],i=e[2],r={queries:{find:o||null},comparator:n,paging:i}):r=null,r},t.prototype.applyCriteriaOptions=function(){var t,e,n,r,i,o,s,l;return t=1<=arguments.length?h.call(arguments,0):[],null==this.options&&(this.options={}),null==(e=this.options).filters&&(e.filters={}),null==(n=this.options).queries&&(n.queries={}),null==(r=this.options).pills&&(r.pills={}),null==(i=this.options).paging&&(i.paging={}),null==(o=this.options).searchString&&(o.searchString=null),null==(s=this.options).comparator&&(s.comparator=null),l=this.extractCriteriaOptions.apply(this,t),l&&(null!=l.filters&&this.setFilters(l.filters),null!=l.queries&&this.setQueries(l.queries),null!=l.pills&&this.setPills(l.pills),null!=l.paging&&this.setPaging(l.paging),null!=l.searchString&&this.setSearchString(l.searchString),null!=l.comparator&&this.setComparator(l.comparator)),this},t.prototype.getPaging=function(){return this.options.paging},t.prototype.setPaging=function(t){return t=u.extend(this.getPaging(),t||{}),t.page||(t.page=null),t.limit||(t.limit=null),t.offset||(t.offset=null),this.options.paging=t,this},t.prototype.getComparator=function(){return this.options.comparator},t.prototype.setComparator=function(t){return t=u.generateComparator(t),this.options.comparator=t,this},t.prototype.getFilter=function(t){return this.options.filters[t]},t.prototype.getFilters=function(){return this.options.filters},t.prototype.setFilters=function(t){var e,n;t||(t={});for(e in t)c.call(t,e)&&(n=t[e],this.setFilter(e,n));return this},t.prototype.setFilter=function(t,e){var n;if("undefined"==typeof e)throw new Error("QueryCollection::setFilter was called without both arguments");return n=this.options.filters,null!=e?n[t]=e:null!=n[t]&&delete n[t],this},t.prototype.getQuery=function(t){return this.options.queries[t]},t.prototype.getQueries=function(){return this.options.queries},t.prototype.setQueries=function(t){var e,n;t||(t={});for(e in t)c.call(t,e)&&(n=t[e],this.setQuery(e,n));return this},t.prototype.setQuery=function(t,e){var n;if("undefined"==typeof e)throw new Error("QueryCollection::setQuery was called without both arguments");return n=this.options.queries,null!=e?(e instanceof i||(e=new i(e)),n[t]=e):null!=n[t]&&delete n[t],this},t.prototype.getPill=function(t){return this.options.pills[t]},t.prototype.getPills=function(){return this.options.pills},t.prototype.setPills=function(t){var e,n;t||(t={});for(e in t)c.call(t,e)&&(n=t[e],this.setPill(e,n));return this},t.prototype.setPill=function(t,e){var n,i;if("undefined"==typeof e)throw new Error("QueryCollection::setPill was called without both arguments");return n=this.getPills(),i=this.getSearchString(),null!=e?(e instanceof r||(e=new r(e)),i&&e.setSearchString(i),n[t]=e):null!=n[t]&&delete n[t],this},t.prototype.getCleanedSearchString=function(){return this.options.cleanedSearchString},t.prototype.getSearchString=function(){return this.options.searchString},t.prototype.setSearchString=function(t){var e,n,r,i;i=this.options.pills,e=t;for(r in i)c.call(i,r)&&(n=i[r],e=n.setSearchString(e));return this.options.searchString=t,this.options.cleanedSearchString=e,this},t.prototype.test=function(){var t;return t=1<=arguments.length?h.call(arguments,0):[],this.testModel.apply(this,t)},t.prototype.testModel=function(t,e){var n;return n=this.testQueries(t,null!=e?e.queries:void 0)&&this.testFilters(t,null!=e?e.filters:void 0)&&this.testPills(t,null!=e?e.pills:void 0)},t.prototype.testModels=function(t,e){var n,r,i,o,s,l,a,c,h,p,d;for(s=this,h=[],a=null!=(p=null!=e?e.paging:void 0)?p:this.getPaging(),n=null!=(null!=e?e.comparator:void 0)?u.generateComparator(null!=e?e.comparator:void 0):this.getComparator(),i=0,o=t.length;o>i;i++)l=t[i],c=s.testModel(l,e),c&&h.push(l);return n&&h.sort(n),a&&(d=a.offset||0,null!=a.limit&&a.limit>0?(d+=a.limit*((a.page||1)-1),r=d+a.limit,h=h.slice(d,r)):h=h.slice(d)),h},t.prototype.testQueries=function(t,e){var n,r,o;n=!0,null==e&&(e=this.getQueries());for(o in e)if(c.call(e,o)&&(r=e[o],r instanceof i||(r=new i(r),e[o]=r),r.test(t)===!1))return n=!1,!1;return n},t.prototype.testFilters=function(t,e){var n,r,i,o;o=!0,n=this.getCleanedSearchString(),null==e&&(e=this.getFilters());for(i in e)if(c.call(e,i)&&(r=e[i],r(t,n)===!1))return o=!1,!1;return o},t.prototype.testPills=function(t,e){var n,i,o,s;if(n=!0,s=this.getSearchString(),null==e&&(e=this.getPills()),null!=s)for(o in e)if(c.call(e,o)&&(i=e[o],i instanceof r||(i=new r(query),i.setSearchString(s),e[o]=i),i.test(t)===!1))return n=!1,!1;return n},t}(),r=function(){function t(t){var e,n,r,i,o,s,l;for(t||(t={}),this.callback=t.callback,this.prefixes=t.prefixes,null!=t.logicalOperator&&(this.logicalOperator=t.logicalOperator),s=[],i=this.prefixes,e=0,n=i.length;n>e;e++)r=i[e],s.push(u.safeRegex(r));l=s.join("|"),o="("+l+")\\s*('[^']+'|\\\"[^\\\"]+\\\"|[^'\\\"\\s]\\S*)",this.regex=u.createRegex(o)}return t.prototype.callback=null,t.prototype.regex=null,t.prototype.prefixes=null,t.prototype.searchString=null,t.prototype.values=null,t.prototype.logicalOperator="OR",t.prototype.setSearchString=function(t){var e,n,r,i;for(e=t,i=[];n=this.regex.exec(t);){switch(r=n[2].trim().replace(/(^['"]\s*|\s*['"]$)/g,"")){case"true":case"TRUE":r=!0;break;case"false":case"FALSE":r=!1;break;case"null":case"NULL":r=null}i.push(r),e=e.replace(n[0],"").trim()}return this.searchString=t,this.values=i,e},t.prototype.test=function(t){var e,n,r,i,o,s,l,a,u;if(null!=(s=this.values)?s.length:void 0)if("OR"===this.logicalOperator)for(o=!1,l=this.values,e=0,r=l.length;r>e&&(u=l[e],!(o=this.callback(t,u)));e++);else{if("AND"!==this.logicalOperator)throw new Error("Unkown logical operator type");for(o=!1,a=this.values,n=0,i=a.length;i>n&&(u=a[n],o=this.callback(t,u),o);n++);}else o=null;return o},t}(),i=function(){function t(t){null==t&&(t={}),this.source=t,this.compileQuery()}return t.prototype.source=null,t.prototype.compiledSelectors=null,t.prototype.selectors={$or:{compile:function(e){var n,r,i,o,s,l;if(i=[],s=u.toArrayGroup(e.selectorValue),!s.length)throw new Error("Query called with an empty "+selectorName+" statement");for(n=0,r=s.length;r>n;n++)l=s[n],o=new t(l),i.push(o);return{queries:i}},test:function(t){var e,n,r,i;for(i=t.queries,e=0,n=i.length;n>e;e++)if(r=i[e],r.test(t.model))return!0;return!1}},$nor:{compile:function(t){return t.selector("$or",t)},test:function(t){return!t.selector("$or",t)}},$and:{compile:function(t){return t.selector("$or",t)},test:function(t){var e,n,r,i;for(i=t.queries,e=0,n=i.length;n>e;e++)if(r=i[e],r.test(t.model)===!1)return!1;return!0}},$not:{compile:function(t){return t.selector("$and",t)},test:function(t){return!t.selector("$and",t)}},string:{test:function(t){return t.modelValueExists&&t.modelValue===t.selectorValue}},number:{test:function(t){return t.selector("string",t)}},"boolean":{test:function(t){return t.selector("string",t)}},array:{test:function(t){return t.modelValueExists&&new n(t.modelValue).isSame(t.selectorValue)}},date:{test:function(t){return t.modelValueExists&&t.modelValue.toString()===t.selectorValue.toString()}},regexp:{test:function(t){return t.modelValueExists&&t.selectorValue.test(t.modelValue)}},"null":{test:function(t){return t.modelValue===t.selectorValue}},$beginsWith:{test:function(t){var e,n,r,i;if(t.selectorValue&&t.modelValueExists&&u.isString(t.modelValue))for(e=u.toArray(t.selectorValue),r=0,i=e.length;i>r;r++)if(n=e[r],t.modelValue.substr(0,n.length)===n)return!0;return!1}},$startsWith:{test:function(t){return t.selector("$beginsWith",t)}},$endsWith:{test:function(t){var e,n,r,i;if(t.selectorValue&&t.modelValueExists&&u.isString(t.modelValue))for(e=u.toArray(t.selectorValue),r=0,i=e.length;i>r;r++)if(n=e[r],t.modelValue.substr(-1*n.length)===n)return!0;return!1}},$finishesWith:{test:function(t){return t.selector("$endsWith",t)}},$all:{test:function(t){return null!=t.selectorValue&&t.modelValueExists&&new n(t.modelValue).hasAll(t.selectorValue)?!0:!1}},$in:{test:function(t){return null!=t.selectorValue&&t.modelValueExists&&(new n(t.modelValue).hasIn(t.selectorValue)||new n(t.selectorValue).hasIn(t.modelValue))?!0:!1}},$nin:{test:function(t){return null!=t.selectorValue&&t.modelValueExists&&new n(t.modelValue).hasIn(t.selectorValue)===!1&&new n(t.selectorValue).hasIn(t.modelValue)===!1?!0:!1}},$has:{test:function(t){return t.modelValueExists&&new n(t.modelValue).hasIn(t.selectorValue)?!0:!1}},$hasAll:{test:function(t){return t.modelValueExists&&new n(t.modelValue).hasIn(t.selectorValue)?!0:!1}},$size:{test:function(t){return null!=t.modelValue.length&&t.modelValue.length===t.selectorValue?!0:!1}},$length:{test:function(t){return t.selector("$size",t)}},$type:{test:function(t){return typeof t.modelValue===t.selectorValue?!0:!1}},$like:{test:function(t){return u.isString(t.modelValue)&&-1!==t.modelValue.toLowerCase().indexOf(t.selectorValue.toLowerCase())?!0:!1}},$likeSensitive:{test:function(t){return u.isString(t.modelValue)&&-1!==t.modelValue.indexOf(t.selectorValue)?!0:!1}},$exists:{test:function(t){return t.selectorValue===t.modelValueExists?!0:!1}},$mod:{test:function(t){var e;return t.modelValueExists&&(e=t.selectorValue,u.isArray(e)||(e=[e]),1===e.length&&e.push(0),t.modelValue%e[0]===e[1])?!0:!1}},$eq:{test:function(t){return u.isEqual(t.modelValue,t.selectorValue)?!0:!1}},$equal:{test:function(t){return t.selector("$eq",t)}},$ne:{test:function(t){return t.modelValue!==t.selectorValue?!0:!1}},$lt:{test:function(t){return null!=t.selectorValue&&u.isComparable(t.modelValue)&&t.modelValue<t.selectorValue?!0:!1}},$gt:{test:function(t){return null!=t.selectorValue&&u.isComparable(t.modelValue)&&t.modelValue>t.selectorValue?!0:!1}},$bt:{test:function(t){return null!=t.selectorValue&&u.isComparable(t.modelValue)&&t.selectorValue[0]<t.modelValue&&t.modelValue<t.selectorValue[1]?!0:!1}},$lte:{test:function(t){return null!=t.selectorValue&&u.isComparable(t.modelValue)&&t.modelValue<=t.selectorValue?!0:!1}},$gte:{test:function(t){return null!=t.selectorValue&&u.isComparable(t.modelValue)&&t.modelValue>=t.selectorValue?!0:!1}},$bte:{test:function(t){return null!=t.selectorValue&&u.isComparable(t.modelValue)&&t.selectorValue[0]<=t.modelValue&&t.modelValue<=t.selectorValue[1]?!0:!1}}},t.prototype.compileSelector=function(t,e){var n,r,i,o,s,l,a,u;if(null==e&&(e={}),s=this,a=this.selectors,o={selectorName:t},l=a[t],!l)throw new Error("Couldn't find the selector "+t);for(i in e)c.call(e,i)&&(u=e[i],o[i]=u);if(null!=l.compile){o.selector=function(t,e){return a[t].compile(e)},n=l.compile(o);for(i in n)c.call(n,i)&&(u=n[i],o[i]=u)}return o.selector=function(t,e){return a[t].test(e)},r={opts:o,test:l.test}},t.prototype.testCompiledSelector=function(t,e){var n,r,i;return r=t.opts,i=t.test,r.model=e,r.modelValue=u.get(r.model,r.fieldName),r.modelId=u.get(r.model,"id"),r.modelValueExists="undefined"!=typeof r.modelValue,r.modelValueExists||(r.modelValue=!1),n=i(r)},t.prototype.compileQuery=function(){var t,e,n,r,i,o,s,l;o=this,r=[],s=this.source;for(i in s)if(c.call(s,i))if(l=s[i],"$or"===i||"$nor"===i||"$and"===i||"$not"===i)n=this.compileSelector(i,{fieldName:i,selectorValue:l}),r.push(n);else if(u.isString(l))n=this.compileSelector("string",{fieldName:i,selectorValue:l}),r.push(n);else if(u.isNumber(l))n=this.compileSelector("number",{fieldName:i,selectorValue:l}),r.push(n);else if(u.isBoolean(l))n=this.compileSelector("boolean",{fieldName:i,selectorValue:l}),r.push(n);else if(u.isArray(l))n=this.compileSelector("array",{fieldName:i,selectorValue:l}),r.push(n);else if(u.isDate(l))n=this.compileSelector("date",{fieldName:i,selectorValue:l}),r.push(n);else if(u.isRegExp(l))n=this.compileSelector("regexp",{fieldName:i,selectorValue:l}),r.push(n);else if(u.isNull(l))n=this.compileSelector("null",{fieldName:i,selectorValue:l}),r.push(n);else if(u.isObject(l))for(t in l)c.call(l,t)&&(e=l[t],n=this.compileSelector(t,{fieldName:i,selectorValue:e}),r.push(n));return this.compiledSelectors=r,this},t.prototype.test=function(t){var e,n,r,i,o;for(i=!0,o=this.compiledSelectors,n=0,r=o.length;r>n&&(e=o[n],i=this.testCompiledSelector(e,t),i!==!1);n++);return i},t}(),l={safeRegex:u.safeRegex,createRegex:u.createRegex,createSafeRegex:u.createSafeRegex,generateComparator:u.generateComparator,toArray:u.toArray,util:u,Backbone:t,Hash:n,QueryCollection:o,Criteria:e,Query:i,Pill:r,setQuerySelector:function(t,e){return null!=e?i.prototype.selectors[t]=e:delete i.prototype.selectors[t],this},testModels:function(){var t,n,r,i;return r=arguments[0],t=2<=arguments.length?h.call(arguments,1):[],r=u.toArray(r),n=function(t,e,n){n.prototype=t.prototype;var r=new n,i=t.apply(r,e);return Object(i)===i?i:r}(e,t,function(){}),i=n.testModels(r)},createCollection:function(t,e){var n;return t=u.toArray(t),n=new o(t,e)},createLiveCollection:function(t,e){var n;return t=u.toArray(t),n=new o(t,e).live(!0)}},"undefined"!=typeof module&&null!==module?module.exports=l:this.queryEngine=l}.call(this),function(){jQuery(function(t){return t.store=function(){var t,e,n,r;return n=function(){var t;try{return"localStorage"in window&&null!==window.localStorage}catch(e){return t=e,!1}}(),n?(r=function(t,e){var n,i,o;try{return localStorage.setItem(t,e),e}catch(s){for(n=s,o=i=0;5>=i;o=++i)localStorage.removeItem(localStorage.key(localStorage.length-1));return r(t,e)}},{set:r,get:function(t){return localStorage[t]},expire:function(t){var e;return e=localStorage[t],localStorage.removeItem(t),e}}):(t=function(t,e,n){var r,i;return n?(r=new Date,r.setTime(r.getTime()+24*n*60*60*1e3),i="; expires="+r.toGMTString()):i="",document.cookie=t+"="+e+i+"; path=/",e},e=function(t){var e,n,r,i;for(t+="=",i=document.cookie.split(";"),n=0,r=i.length;r>n;n++)if(e=i[n],0===e.indexOf(t))return e.replace(/^\s+/,"").substring(t.length+1,e.length);return null},{set:function(e,n){return t(e,n,1)},get:e,expire:function(e){var n;return n=Store.get(e),t(e,"",-1),n}})}()})}.call(this);